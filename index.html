
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¸­å­èµ›è·‘ç‚¹åæ¸¸æˆ - ç»ˆæç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #FF6B35;
            --secondary: #1A535C;
            --accent: #4ECDC4;
            --light: #F7FFF7;
            --dark: #292F36;
            --yellow: #FFE66D;
            --blue: #1E90FF;
            --green: #06D6A0;
            --purple: #7209B7;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--dark);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        h1 {
            color: var(--primary);
            font-size: 3.2rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 var(--yellow);
            letter-spacing: 1px;
            background: linear-gradient(45deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: var(--secondary);
            font-size: 1.4rem;
            font-weight: 500;
            margin-bottom: 20px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            text-align: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.9);
            padding: 18px;
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            min-width: 140px;
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 1rem;
            color: var(--secondary);
            margin-top: 5px;
        }
        
        .river-container {
            position: relative;
            height: 700px; /* å‡å°‘é«˜åº¦ï¼Œå‹ç¼©ç•™ç™½ */
            background: linear-gradient(to bottom, #4A90E2, #7FB3D5);
            border-radius: 20px;
            margin: 30px 0;
            overflow: hidden;
            border: 10px solid #2C5F9B;
            box-shadow: 
                inset 0 0 30px rgba(0, 0, 0, 0.3),
                0 10px 30px rgba(0,0,0,0.2);
        }
        
        .river {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255,255,255,0.2) 5%, transparent 10%),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.2) 5%, transparent 10%),
                radial-gradient(circle at 40% 20%, rgba(255,255,255,0.2) 5%, transparent 10%);
            animation: river-flow 15s linear infinite;
        }
        
        @keyframes river-flow {
            0% { background-position: 0 0, 100px 50px, 200px 100px; }
            100% { background-position: 100px 0, 200px 50px, 300px 100px; }
        }
        
        .finish-line {
            position: absolute;
            right: 0;
            top: 0;
            width: 20px;
            height: 100%;
            background: repeating-linear-gradient(
                to bottom,
                var(--primary),
                var(--primary) 30px,
                var(--light) 30px,
                var(--light) 60px
            );
            z-index: 10;
            box-shadow: -5px 0 15px rgba(0,0,0,0.3);
        }
        
        .finish-flag {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 4rem;
            color: var(--primary);
            z-index: 11;
            filter: drop-shadow(3px 3px 2px rgba(0,0,0,0.3));
            animation: flag-wave 2s infinite alternate;
        }
        
        @keyframes flag-wave {
            0% { transform: translateY(-50%) rotate(-5deg); }
            100% { transform: translateY(-50%) rotate(5deg); }
        }
        
        .duck {
            position: absolute;
            width: 80px; /* å¢åŠ é¸­å­å¤§å° */
            height: 80px;
            transition: left 0.1s linear;
            z-index: 5;
            filter: drop-shadow(3px 3px 3px rgba(0,0,0,0.3));
            animation: duck-float 3s infinite ease-in-out;
        }
        
        @keyframes duck-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .duck-body {
            position: absolute;
            width: 60px; /* å¢åŠ é¸­å­èº«ä½“å¤§å° */
            height: 50px;
            background: var(--yellow);
            border-radius: 50% 50% 40% 40%;
            top: 20px;
            left: 5px;
            box-shadow: inset -3px -3px 5px rgba(0,0,0,0.1);
        }
        
        .duck-head {
            position: absolute;
            width: 40px; /* å¢åŠ é¸­å­å¤´éƒ¨å¤§å° */
            height: 40px;
            background: var(--yellow);
            border-radius: 50%;
            top: 5px;
            left: 40px;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.1);
        }
        
        .duck-beak {
            position: absolute;
            width: 20px; /* å¢åŠ é¸­å­å˜´å·´å¤§å° */
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
            top: 20px;
            left: 75px;
        }
        
        .duck-eye {
            position: absolute;
            width: 8px; /* å¢åŠ é¸­å­çœ¼ç›å¤§å° */
            height: 8px;
            background: var(--dark);
            border-radius: 50%;
            top: 12px;
            left: 60px;
        }
        
        .duck-eye::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 1px;
        }
        
        .duck-wing {
            position: absolute;
            width: 25px; /* å¢åŠ é¸­å­ç¿…è†€å¤§å° */
            height: 18px;
            background: #ffb347;
            border-radius: 50%;
            top: 30px;
            left: 25px;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.1);
            animation: wing-flap 1s infinite alternate;
        }
        
        @keyframes wing-flap {
            0% { transform: scaleY(1); }
            100% { transform: scaleY(0.8); }
        }
        
        .duck-name {
            position: absolute;
            top: -30px; /* è°ƒæ•´åå­—ä½ç½® */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.9rem; /* å¢åŠ å­—ä½“å¤§å° */
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            border: 1px solid rgba(0,0,0,0.1);
            z-index: 6;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 16px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(-2px);
        }
        
        .start-btn {
            background: var(--accent);
            color: white;
        }
        
        .reset-btn {
            background: var(--secondary);
            color: white;
        }
        
        .import-btn {
            background: var(--primary);
            color: white;
        }
        
        .add-btn {
            background: var(--yellow);
            color: var(--dark);
        }
        
        .input-area {
            display: flex;
            gap: 15px;
            margin: 25px 0;
        }
        
        input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--accent);
            border-radius: 50px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.9);
        }
        
        input:focus {
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        
        .result-area {
            text-align: center;
            margin: 30px 0;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,230,109,0.2));
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 2px dashed var(--accent);
        }
        
        .result {
            font-size: 2.8rem;
            color: var(--primary);
            font-weight: bold;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        
        .winner {
            animation: winner-pulse 1s infinite, color-change 3s infinite, winner-glow 2s infinite;
        }
        
        @keyframes winner-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes color-change {
            0% { color: var(--primary); }
            25% { color: #FF4500; }
            50% { color: var(--purple); }
            75% { color: #06D6A0; }
            100% { color: var(--primary); }
        }
        
        @keyframes winner-glow {
            0%, 100% { text-shadow: 0 0 10px rgba(255,107,53,0.7); }
            50% { text-shadow: 0 0 20px rgba(255,107,53,1), 0 0 30px rgba(255,230,109,0.7); }
        }
        
        .lists-container {
            display: flex;
            gap: 25px;
            margin-top: 30px;
        }
        
        .name-list, .history-list {
            flex: 1;
            background: rgba(247, 255, 247, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        ul {
            list-style-type: none;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        ul::-webkit-scrollbar {
            width: 8px;
        }
        
        ul::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
        }
        
        ul::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }
        
        li {
            padding: 12px 18px;
            margin-bottom: 10px;
            background: white;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s;
        }
        
        li:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
        }
        
        .delete-btn {
            background: #e63946;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: #c1121f;
            transform: scale(1.1);
        }
        
        .empty-message {
            color: #999;
            text-align: center;
            padding: 30px;
            font-style: italic;
            font-size: 1.1rem;
        }
        
        .waves {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 40" preserveAspectRatio="none"><path d="M0,20 Q25,10 50,20 T100,20 L100,40 L0,40 Z" fill="%232C5F9B" opacity="0.6"/></svg>') repeat-x;
            animation: waves 4s linear infinite;
        }
        
        @keyframes waves {
            0% { background-position: 0 0; }
            100% { background-position: 100px 0; }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 25px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .modal h3 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .modal textarea {
            width: 100%;
            height: 250px;
            padding: 20px;
            border: 2px solid var(--accent);
            border-radius: 15px;
            font-size: 1rem;
            margin-bottom: 25px;
            resize: vertical;
            background: rgba(255,255,255,0.9);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--primary);
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
        }
        
        .river-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .lily-pad {
            position: absolute;
            width: 60px;
            height: 60px;
            background: var(--green);
            border-radius: 50%;
            opacity: 0.7;
            z-index: 2;
        }
        
        .lily-pad::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            top: 5px;
            left: 5px;
        }
        
        .bubble {
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            animation: bubble-rise 8s infinite ease-in;
        }
        
        @keyframes bubble-rise {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-500px) scale(1.5);
                opacity: 0;
            }
        }
        
        @media (max-width: 1200px) {
            .container {
                max-width: 95%;
            }
            
            .river-container {
                height: 600px;
            }
        }
        
        @media (max-width: 768px) {
            .lists-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .river-container {
                height: 500px;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            .result {
                font-size: 2.2rem;
            }
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .speed-control label {
            font-weight: bold;
            color: var(--secondary);
        }
        
        .speed-control input {
            width: 200px;
            padding: 8px;
        }
        
        .lane {
            position: absolute;
            left: 0;
            width: 100%;
            height: 60px; /* å‡å°‘æ³³é“é«˜åº¦ä»¥é€‚åº”æ›´å¤šæ³³é“ */
            border-bottom: 1px dashed rgba(255,255,255,0.3);
            z-index: 1;
        }
        
        .lane-number {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.7);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--secondary);
            z-index: 2;
        }
        
        .race-progress {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--secondary);
            z-index: 10;
        }
        
        .ranking-container {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 15px;
            max-width: 220px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .ranking-title {
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 5px;
        }
        
        .ranking-list {
            list-style-type: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .ranking-item {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .ranking-position {
            font-weight: bold;
            color: var(--primary);
            width: 25px;
            font-size: 1.1rem;
        }
        
        .ranking-name {
            flex: 1;
            font-weight: bold;
            padding: 0 8px;
        }
        
        .ranking-progress {
            color: var(--secondary);
            font-size: 1rem;
            font-weight: bold;
            min-width: 50px;
            text-align: right;
        }
        
        /* æ·»åŠ æ’åæ•°å­—çš„è§†è§‰å·®å¼‚ */
        .ranking-item:nth-child(1) .ranking-position {
            color: #FFD700; /* é‡‘è‰² */
            font-size: 1.3rem;
        }
        
        .ranking-item:nth-child(2) .ranking-position {
            color: #C0C0C0; /* é“¶è‰² */
            font-size: 1.2rem;
        }
        
        .ranking-item:nth-child(3) .ranking-position {
            color: #CD7F32; /* é“œè‰² */
            font-size: 1.1rem;
        }
        
        .ranking-item:nth-child(1) .ranking-progress {
            color: #FF4500; /* çº¢è‰² */
            font-weight: bold;
        }
        
        .ranking-item:nth-child(2) .ranking-progress {
            color: #FF6347; /* ç•ªèŒ„çº¢ */
        }
        
        .ranking-item:nth-child(3) .ranking-progress {
            color: #FF8C00; /* æ·±æ©™è‰² */
        }
        
        /* é“å…·æ ·å¼ */
        .item {
            position: absolute;
            width: 45px; /* å¢åŠ é“å…·å¤§å° */
            height: 45px;
            border-radius: 50%;
            z-index: 7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem; /* å¢åŠ é“å…·å›¾æ ‡å¤§å° */
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.3));
            animation: item-float 2s infinite ease-in-out;
        }
        
        @keyframes item-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .speed-item {
            background: #FF6B6B;
            color: white;
        }
        
        .swap-item {
            background: #4ECDC4;
            color: white;
        }
        
        .slow-item {
            background: #FFD166;
            color: #333;
        }
        
        .teleport-item {
            background: #7209B7;
            color: white;
        }
        
        .shield-item {
            background: #3A86FF;
            color: white;
        }
        
        .clone-item {
            background: #06D6A0;
            color: white;
        }
        
        .item-effect {
            position: absolute;
            color: white;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 10px;
            z-index: 20;
            animation: effect-fade 1.5s forwards;
        }
        
        @keyframes effect-fade {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }
        
        .speed-effect {
            background: rgba(255, 107, 107, 0.8);
        }
        
        .swap-effect {
            background: rgba(78, 205, 196, 0.8);
        }
        
        .slow-effect {
            background: rgba(255, 209, 102, 0.8);
        }
        
        .teleport-effect {
            background: rgba(114, 9, 183, 0.8);
        }
        
        .shield-effect {
            background: rgba(58, 134, 255, 0.8);
        }
        
        .clone-effect {
            background: rgba(6, 214, 160, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-duck"></i> é¸­å­èµ›è·‘ç‚¹åæ¸¸æˆ - ç»ˆæç‰ˆ</h1>
            <p class="subtitle">10æ¡èµ›é“ + 6ç§é“å…· + 100%å®Œæˆæ¯”èµ› + æ›´å¤§çš„é¸­å­</p>
        </header>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="totalStudents">0</div>
                <div class="stat-label">æ€»å­¦ç”Ÿæ•°</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="totalRaces">0</div>
                <div class="stat-label">æ¯”èµ›æ¬¡æ•°</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="lastWinner">-</div>
                <div class="stat-label">ä¸Šæ¬¡è·èƒœè€…</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="maxStudents">50</div>
                <div class="stat-label">æœ€å¤§å®¹é‡</div>
            </div>
        </div>
        
        <div class="speed-control">
            <label for="speedRange">æ¯”èµ›é€Ÿåº¦:</label>
            <input type="range" id="speedRange" min="1" max="10" value="5">
            <span id="speedValue">ä¸­ç­‰</span>
        </div>
        
        <div class="river-container">
            <div class="river"></div>
            <div class="river-decoration" id="riverDecoration"></div>
            <div class="waves"></div>
            <div class="finish-line"></div>
            <div class="finish-flag"><i class="fas fa-flag-checkered"></i></div>
            <div id="lanes-container"></div>
            <div id="ducks-container"></div>
            <div id="items-container"></div>
            <div class="race-progress" id="raceProgress">æ¯”èµ›å‡†å¤‡ä¸­...</div>
            <div class="ranking-container">
                <div class="ranking-title">å®æ—¶æ’å</div>
                <ul class="ranking-list" id="rankingList">
                    <li class="ranking-item"><span class="ranking-position">-</span><span class="ranking-name">ç­‰å¾…æ¯”èµ›å¼€å§‹</span><span class="ranking-progress">-</span></li>
                </ul>
            </div>
        </div>
        
        <div class="result-area">
            <div class="result" id="result">ç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œè§‚çœ‹é¸­å­èµ›è·‘ï¼</div>
            <p id="result-subtitle">å‡†å¤‡å¥½å¼€å§‹ä¸€åœºæœ‰è¶£çš„æ¯”èµ›äº†å—ï¼Ÿ</p>
        </div>
        
        <div class="controls">
            <button class="start-btn" id="startBtn">
                <i class="fas fa-play"></i> å¼€å§‹èµ›è·‘
            </button>
            <button class="reset-btn" id="resetBtn">
                <i class="fas fa-redo"></i> é‡ç½®æ¯”èµ›
            </button>
            <button class="import-btn" id="importBtn">
                <i class="fas fa-file-import"></i> å¯¼å…¥åå•
            </button>
            <button class="add-btn" id="addBtn">
                <i class="fas fa-plus"></i> æ·»åŠ å­¦ç”Ÿ
            </button>
        </div>
        
        <div class="input-area">
            <input type="text" id="nameInput" placeholder="è¾“å…¥å­¦ç”Ÿå§“åï¼ŒæŒ‰å›è½¦æ·»åŠ ">
            <button class="add-btn" id="addBtn2">
                <i class="fas fa-plus-circle"></i> æ·»åŠ 
            </button>
        </div>
        
        <div class="lists-container">
            <div class="name-list">
                <h2><i class="fas fa-list"></i> å­¦ç”Ÿåå• (<span id="count">0</span>)</h2>
                <ul id="nameList">
                    <li class="empty-message">åå•ä¸ºç©ºï¼Œè¯·æ·»åŠ å­¦ç”Ÿ</li>
                </ul>
            </div>
            
            <div class="history-list">
                <h2><i class="fas fa-history"></i> è·èƒœå†å²</h2>
                <ul id="historyList">
                    <li class="empty-message">æš‚æ— å†å²è®°å½•</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="modal" id="importModal">
        <div class="modal-content">
            <h3><i class="fas fa-file-import"></i> å¯¼å…¥ç­çº§åå•</h3>
            <p>è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼Œæ¯è¡Œä¸€ä¸ªï¼ˆæœ€å¤š50åå­¦ç”Ÿï¼‰ï¼š</p>
            <textarea id="importTextarea" placeholder="ä¾‹å¦‚ï¼š
å¼ ä¸‰
æå››
ç‹äº”
èµµå…­"></textarea>
            <div class="modal-buttons">
                <button class="reset-btn" id="cancelImport">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
                <button class="start-btn" id="confirmImport">
                    <i class="fas fa-check"></i> ç¡®è®¤å¯¼å…¥
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const startBtn = document.getElementById('startBtn');
            const resetBtn = document.getElementById('resetBtn');
            const importBtn = document.getElementById('importBtn');
            const addBtn = document.getElementById('addBtn');
            const addBtn2 = document.getElementById('addBtn2');
            const nameInput = document.getElementById('nameInput');
            const result = document.getElementById('result');
            const resultSubtitle = document.getElementById('result-subtitle');
            const nameList = document.getElementById('nameList');
            const historyList = document.getElementById('historyList');
            const countElement = document.getElementById('count');
            const ducksContainer = document.getElementById('ducks-container');
            const lanesContainer = document.getElementById('lanes-container');
            const itemsContainer = document.getElementById('items-container');
            const importModal = document.getElementById('importModal');
            const importTextarea = document.getElementById('importTextarea');
            const cancelImport = document.getElementById('cancelImport');
            const confirmImport = document.getElementById('confirmImport');
            const totalStudents = document.getElementById('totalStudents');
            const totalRaces = document.getElementById('totalRaces');
            const lastWinner = document.getElementById('lastWinner');
            const riverDecoration = document.getElementById('riverDecoration');
            const speedRange = document.getElementById('speedRange');
            const speedValue = document.getElementById('speedValue');
            const raceProgress = document.getElementById('raceProgress');
            const rankingList = document.getElementById('rankingList');
            
            // åˆå§‹åŒ–åå•å’Œå†å²è®°å½•
            let nameArray = [];
            let historyArray = [];
            let isRacing = false;
            let raceInterval;
            let duckPositions = {};
            let duckElements = {};
            let duckSpeeds = {};
            let duckEffects = {}; // å­˜å‚¨æ¯åªé¸­å­çš„é“å…·æ•ˆæœ
            let stats = {
                races: 0,
                lastWinner: '-'
            };
            let raceSpeed = 5;
            let items = []; // å­˜å‚¨é“å…·ä¿¡æ¯
            
            // é¸­å­é¢œè‰²
            let duckColors = [
                '#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', 
                '#118AB2', '#EF476F', '#7BDFF2', '#B2F7EF',
                '#F7B267', '#F25F5C', '#50514F', '#F2C57C',
                '#7209B7', '#3A86FF', '#FB5607', '#FF006E'
            ];
            
            // äº‹ä»¶ç›‘å¬
            startBtn.addEventListener('click', startRace);
            resetBtn.addEventListener('click', resetRace);
            importBtn.addEventListener('click', () => importModal.style.display = 'flex');
            addBtn.addEventListener('click', addName);
            addBtn2.addEventListener('click', addName);
            nameInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addName();
            });
            cancelImport.addEventListener('click', () => importModal.style.display = 'none');
            confirmImport.addEventListener('click', importNames);
            speedRange.addEventListener('input', updateSpeed);
            
            // æ›´æ–°é€Ÿåº¦
            function updateSpeed() {
                raceSpeed = parseInt(speedRange.value);
                const speedLabels = ['éå¸¸æ…¢', 'æ…¢', 'è¾ƒæ…¢', 'ç¨æ…¢', 'ä¸­ç­‰', 'ç¨å¿«', 'è¾ƒå¿«', 'å¿«', 'å¾ˆå¿«', 'éå¸¸å¿«'];
                speedValue.textContent = speedLabels[raceSpeed - 1];
            }
            
            // åˆ›å»ºæ²³æµè£…é¥°
            function createRiverDecoration() {
                riverDecoration.innerHTML = '';
                
                // åˆ›å»ºç¡è²
                for (let i = 0; i < 12; i++) {
                    const lilyPad = document.createElement('div');
                    lilyPad.className = 'lily-pad';
                    lilyPad.style.left = `${20 + Math.random() * 70}%`;
                    lilyPad.style.top = `${30 + Math.random() * 60}%`;
                    lilyPad.style.transform = `scale(${0.7 + Math.random() * 0.6})`;
                    riverDecoration.appendChild(lilyPad);
                }
                
                // åˆ›å»ºæ°”æ³¡
                for (let i = 0; i < 25; i++) {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    bubble.style.left = `${Math.random() * 100}%`;
                    bubble.style.bottom = `-20px`;
                    bubble.style.animationDelay = `${Math.random() * 8}s`;
                    bubble.style.width = `${5 + Math.random() * 15}px`;
                    bubble.style.height = bubble.style.width;
                    riverDecoration.appendChild(bubble);
                }
            }
            
            // åˆ›å»ºæ³³é“
            function createLanes() {
                lanesContainer.innerHTML = '';
                const laneCount = 10; // å¢åŠ åˆ°10æ¡èµ›é“
                
                for (let i = 0; i < laneCount; i++) {
                    const lane = document.createElement('div');
                    lane.className = 'lane';
                    lane.style.top = `${50 + i * 60}px`; // è°ƒæ•´æ³³é“ä½ç½®ï¼Œå‡å°‘ç•™ç™½
                    
                    const laneNumber = document.createElement('div');
                    laneNumber.className = 'lane-number';
                    laneNumber.textContent = i + 1;
                    
                    lane.appendChild(laneNumber);
                    lanesContainer.appendChild(lane);
                }
            }
            
            // åˆ›å»ºé¸­å­
            function createDucks() {
                ducksContainer.innerHTML = '';
                duckPositions = {};
                duckElements = {};
                duckEffects = {};
                
                const maxDucks = 50;
                const rows = 10; // 10è¡Œæ³³é“
                const ducksPerRow = Math.ceil(nameArray.length / rows);
                
                nameArray.forEach((name, index) => {
                    // è®¡ç®—è¡Œå’Œåˆ—
                    const row = Math.floor(index / ducksPerRow);
                    const col = index % ducksPerRow;
                    
                    // è®¡ç®—å‚ç›´ä½ç½® - å‡åŒ€åˆ†å¸ƒï¼Œä½¿ç”¨æ³³é“
                    const top = 50 + (row * 60) + (Math.random() * 20 - 10);
                    
                    // åˆ›å»ºé¸­å­å…ƒç´ 
                    const duck = document.createElement('div');
                    duck.className = 'duck';
                    duck.id = `duck-${index}`;
                    duck.style.top = `${top}px`;
                    duck.style.left = '0px'; // åˆå§‹ä½ç½®ä¸º0
                    
                    // éšæœºåˆ†é…é¢œè‰²
                    const colorIndex = index % duckColors.length;
                    
                    duck.innerHTML = `
                        <div class="duck-body" style="background: ${duckColors[colorIndex]}"></div>
                        <div class="duck-head" style="background: ${duckColors[colorIndex]}"></div>
                        <div class="duck-beak"></div>
                        <div class="duck-eye"></div>
                        <div class="duck-wing" style="background: ${duckColors[colorIndex]}80"></div>
                        <div class="duck-name">${name}</div>
                    `;
                    
                    ducksContainer.appendChild(duck);
                    
                    // åˆå§‹åŒ–ä½ç½®
                    duckPositions[name] = 0;
                    duckElements[name] = duck;
                    duckEffects[name] = {
                        speedBoost: 0,
                        speedBoostEnd: 0,
                        slowDown: 0,
                        slowDownEnd: 0,
                        shield: false,
                        shieldEnd: 0,
                        clone: false
                    };
                });
                
                updateStats();
            }
            
            // ä¸ºæ¯”èµ›åˆ†é…é€Ÿåº¦ï¼ˆæ¯æ¬¡æ¯”èµ›é‡æ–°åˆ†é…ï¼‰
            function assignSpeeds() {
                duckSpeeds = {};
                
                // ç¡®ä¿æ¯ä¸ªå­¦ç”Ÿçš„è·èƒœæ¦‚ç‡æ›´åŠ å¹³å‡
                // ä½¿ç”¨æ›´çª„çš„é€Ÿåº¦èŒƒå›´ï¼Œå‡å°‘é€Ÿåº¦å·®å¼‚
                const baseSpeed = 0.15;
                const speedVariation = 0.1;
                
                nameArray.forEach(name => {
                    // ä¸ºæ¯åªé¸­å­åˆ†é…å›ºå®šé€Ÿåº¦
                    // ä½¿ç”¨æ›´çª„çš„é€Ÿåº¦èŒƒå›´ï¼Œä½¿æ¯”èµ›æ›´åŠ å…¬å¹³
                    duckSpeeds[name] = baseSpeed + (Math.random() * speedVariation);
                });
            }
            
            // åˆ›å»ºé“å…·
            function createItems() {
                itemsContainer.innerHTML = '';
                items = [];
                
                // åˆ›å»º5-8ä¸ªé“å…·
                const itemCount = 5 + Math.floor(Math.random() * 4);
                
                for (let i = 0; i < itemCount; i++) {
                    // éšæœºé€‰æ‹©é“å…·ç±»å‹
                    const itemTypes = ['speed', 'swap', 'slow', 'teleport', 'shield', 'clone'];
                    const itemType = itemTypes[Math.floor(Math.random() * itemTypes.length)];
                    
                    // éšæœºä½ç½®
                    const left = 20 + Math.random() * 60; // 20%åˆ°80%ä¹‹é—´
                    const top = 50 + Math.random() * 500; // åœ¨æ³³é“èŒƒå›´å†…
                    
                    // åˆ›å»ºé“å…·å…ƒç´ 
                    const item = document.createElement('div');
                    item.className = `item ${itemType}-item`;
                    item.style.left = `${left}%`;
                    item.style.top = `${top}px`;
                    
                    // è®¾ç½®é“å…·å›¾æ ‡
                    let icon;
                    switch(itemType) {
                        case 'speed':
                            icon = 'âš¡';
                            break;
                        case 'swap':
                            icon = 'ğŸ”„';
                            break;
                        case 'slow':
                            icon = 'ğŸŒ';
                            break;
                        case 'teleport':
                            icon = 'âœ¨';
                            break;
                        case 'shield':
                            icon = 'ğŸ›¡ï¸';
                            break;
                        case 'clone':
                            icon = 'ğŸ“‹';
                            break;
                    }
                    
                    item.textContent = icon;
                    
                    itemsContainer.appendChild(item);
                    
                    // å­˜å‚¨é“å…·ä¿¡æ¯
                    items.push({
                        element: item,
                        type: itemType,
                        left: left,
                        top: top,
                        collected: false
                    });
                }
            }
            
            // æ£€æŸ¥é“å…·ç¢°æ’
            function checkItemCollisions() {
                nameArray.forEach(name => {
                    const duck = duckElements[name];
                    const duckRect = duck.getBoundingClientRect();
                    
                    items.forEach((item, index) => {
                        if (item.collected) return;
                        
                        const itemRect = item.element.getBoundingClientRect();
                        
                        // ç®€å•çš„ç¢°æ’æ£€æµ‹
                        if (duckRect.left < itemRect.right &&
                            duckRect.right > itemRect.left &&
                            duckRect.top < itemRect.bottom &&
                            duckRect.bottom > itemRect.top) {
                            
                            // æ”¶é›†é“å…·
                            item.collected = true;
                            item.element.style.display = 'none';
                            
                            // åº”ç”¨é“å…·æ•ˆæœ
                            applyItemEffect(name, item.type);
                            
                            // æ˜¾ç¤ºæ•ˆæœæç¤º
                            showEffectMessage(name, item.type);
                        }
                    });
                });
            }
            
            // åº”ç”¨é“å…·æ•ˆæœ
            function applyItemEffect(duckName, itemType) {
                const now = Date.now();
                
                switch(itemType) {
                    case 'speed':
                        // åŠ é€Ÿæ•ˆæœæŒç»­3ç§’
                        duckEffects[duckName].speedBoost = 0.3;
                        duckEffects[duckName].speedBoostEnd = now + 3000;
                        break;
                    case 'swap':
                        // éšæœºä¸å¦ä¸€åªé¸­å­äº¤æ¢ä½ç½®
                        const otherDucks = nameArray.filter(name => name !== duckName);
                        if (otherDucks.length > 0) {
                            const randomDuck = otherDucks[Math.floor(Math.random() * otherDucks.length)];
                            const tempPosition = duckPositions[duckName];
                            duckPositions[duckName] = duckPositions[randomDuck];
                            duckPositions[randomDuck] = tempPosition;
                            
                            // æ›´æ–°ä½ç½®
                            duckElements[duckName].style.left = `${duckPositions[duckName]}%`;
                            duckElements[randomDuck].style.left = `${duckPositions[randomDuck]}%`;
                        }
                        break;
                    case 'slow':
                        // å‡é€Ÿæ•ˆæœæŒç»­2ç§’
                        duckEffects[duckName].slowDown = 0.2;
                        duckEffects[duckName].slowDownEnd = now + 2000;
                        break;
                    case 'teleport':
                        // éšæœºä¼ é€åˆ°èµ›é“ä¸Šçš„æŸä¸ªä½ç½®
                        const newPosition = 10 + Math.random() * 70; // 10%åˆ°80%ä¹‹é—´
                        duckPositions[duckName] = newPosition;
                        duckElements[duckName].style.left = `${newPosition}%`;
                        break;
                    case 'shield':
                        // æŠ¤ç›¾æ•ˆæœæŒç»­4ç§’ï¼Œå…ç–«è´Ÿé¢æ•ˆæœ
                        duckEffects[duckName].shield = true;
                        duckEffects[duckName].shieldEnd = now + 4000;
                        break;
                    case 'clone':
                        // å¤åˆ¶æœ€è¿‘ä¸€ä¸ªæ­£é¢æ•ˆæœ
                        duckEffects[duckName].clone = true;
                        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œç›´æ¥ç»™ä¸€ä¸ªåŠ é€Ÿæ•ˆæœ
                        duckEffects[duckName].speedBoost = 0.2;
                        duckEffects[duckName].speedBoostEnd = now + 2000;
                        break;
                }
            }
            
            // æ˜¾ç¤ºæ•ˆæœæç¤º
            function showEffectMessage(duckName, itemType) {
                const duck = duckElements[duckName];
                const duckRect = duck.getBoundingClientRect();
                const containerRect = document.querySelector('.river-container').getBoundingClientRect();
                
                const effect = document.createElement('div');
                effect.className = `item-effect ${itemType}-effect`;
                
                let message;
                switch(itemType) {
                    case 'speed':
                        message = 'åŠ é€Ÿï¼';
                        break;
                    case 'swap':
                        message = 'ä½ç½®äº¤æ¢ï¼';
                        break;
                    case 'slow':
                        message = 'å‡é€Ÿï¼';
                        break;
                    case 'teleport':
                        message = 'ç¬é—´ä¼ é€ï¼';
                        break;
                    case 'shield':
                        message = 'æŠ¤ç›¾ä¿æŠ¤ï¼';
                        break;
                    case 'clone':
                        message = 'æ•ˆæœå¤åˆ¶ï¼';
                        break;
                }
                
                effect.textContent = message;
                effect.style.left = `${duckRect.left - containerRect.left}px`;
                effect.style.top = `${duckRect.top - containerRect.top - 30}px`;
                
                document.querySelector('.river-container').appendChild(effect);
                
                // 3ç§’åç§»é™¤æ•ˆæœæç¤º
                setTimeout(() => {
                    effect.remove();
                }, 1500);
            }
            
            // æ›´æ–°æ’å
            function updateRanking() {
                // åˆ›å»ºæ’åæ•°ç»„
                const ranking = Object.keys(duckPositions)
                    .map(name => ({
                        name,
                        position: duckPositions[name]
                    }))
                    .sort((a, b) => b.position - a.position)
                    .slice(0, 10); // åªæ˜¾ç¤ºå‰10å
                
                // æ›´æ–°æ’åæ˜¾ç¤º
                rankingList.innerHTML = '';
                
                if (ranking.length === 0) {
                    const li = document.createElement('li');
                    li.className = 'ranking-item';
                    li.innerHTML = '<span class="ranking-position">-</span><span class="ranking-name">ç­‰å¾…æ¯”èµ›å¼€å§‹</span><span class="ranking-progress">-</span>';
                    rankingList.appendChild(li);
                    return;
                }
                
                ranking.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.className = 'ranking-item';
                    
                    const positionSpan = document.createElement('span');
                    positionSpan.className = 'ranking-position';
                    positionSpan.textContent = index + 1;
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'ranking-name';
                    nameSpan.textContent = item.name;
                    
                    const progressSpan = document.createElement('span');
                    progressSpan.className = 'ranking-progress';
                    // æ˜¾ç¤ºä¸€ä½å°æ•°ï¼Œä½¿æ’åå·®è·æ›´æ˜æ˜¾
                    progressSpan.textContent = `${Math.min(100, parseFloat(item.position).toFixed(1))}%`;
                    
                    li.appendChild(positionSpan);
                    li.appendChild(nameSpan);
                    li.appendChild(progressSpan);
                    
                    rankingList.appendChild(li);
                });
            }
            
            // å¼€å§‹èµ›è·‘
            function startRace() {
                if (nameArray.length === 0) {
                    alert('è¯·å…ˆæ·»åŠ å­¦ç”Ÿåˆ°åå•ä¸­ï¼');
                    return;
                }
                
                if (isRacing) return;
                
                isRacing = true;
                startBtn.disabled = true;
                result.textContent = "æ¯”èµ›è¿›è¡Œä¸­...";
                resultSubtitle.textContent = "é¸­å­ä»¬æ­£åœ¨å¥‹åŠ›å‘å‰æ¸¸ï¼";
                result.classList.remove('winner');
                
                // é‡ç½®æ‰€æœ‰é¸­å­çš„ä½ç½®
                nameArray.forEach(name => {
                    duckPositions[name] = 0;
                    duckElements[name].style.left = '0px';
                    duckEffects[name] = {
                        speedBoost: 0,
                        speedBoostEnd: 0,
                        slowDown: 0,
                        slowDownEnd: 0,
                        shield: false,
                        shieldEnd: 0,
                        clone: false
                    };
                });
                
                // ä¸ºæ¯”èµ›é‡æ–°åˆ†é…é€Ÿåº¦
                assignSpeeds();
                
                // åˆ›å»ºé“å…·
                createItems();
                
                // å¼€å§‹æ¯”èµ›
                raceInterval = setInterval(() => {
                    let allFinished = true;
                    let leader = null;
                    let maxPosition = 0;
                    const now = Date.now();
                    
                    nameArray.forEach(name => {
                        if (duckPositions[name] < 100) { // æ”¹ä¸º100%å®Œæˆæ¯”èµ›
                            // åŸºç¡€é€Ÿåº¦
                            let speed = duckSpeeds[name] * (raceSpeed / 5);
                            
                            // åº”ç”¨é“å…·æ•ˆæœ
                            if (duckEffects[name].speedBoost > 0 && now < duckEffects[name].speedBoostEnd) {
                                speed += duckEffects[name].speedBoost;
                            }
                            
                            if (duckEffects[name].slowDown > 0 && now < duckEffects[name].slowDownEnd) {
                                // å¦‚æœæœ‰æŠ¤ç›¾ï¼Œå…ç–«å‡é€Ÿæ•ˆæœ
                                if (!duckEffects[name].shield || now >= duckEffects[name].shieldEnd) {
                                    speed -= duckEffects[name].slowDown;
                                    if (speed < 0.01) speed = 0.01; // æœ€å°é€Ÿåº¦
                                }
                            }
                            
                            // å¢åŠ æ‚¬å¿µï¼šéšæœºæ³¢åŠ¨
                            const randomFactor = 0.8 + Math.random() * 0.4; // 0.8åˆ°1.2ä¹‹é—´
                            speed *= randomFactor;
                            
                            // è½åè¿½èµ¶æœºåˆ¶ï¼šè½åè¶Šå¤šï¼Œé€Ÿåº¦åŠ æˆè¶Šå¤š
                            const maxDuckPosition = Math.max(...Object.values(duckPositions));
                            const positionDifference = maxDuckPosition - duckPositions[name];
                            if (positionDifference > 10) {
                                speed *= (1 + (positionDifference * 0.01)); // æ¯è½å10%ï¼Œé€Ÿåº¦å¢åŠ 1%
                            }
                            
                            duckPositions[name] += speed;
                            duckElements[name].style.left = `${duckPositions[name]}%`;
                            allFinished = false;
                            
                            // æ›´æ–°é¢†å…ˆè€…
                            if (duckPositions[name] > maxPosition) {
                                maxPosition = duckPositions[name];
                                leader = name;
                            }
                        }
                    });
                    
                    // æ£€æŸ¥é“å…·ç¢°æ’
                    checkItemCollisions();
                    
                    // æ›´æ–°æ¯”èµ›è¿›åº¦
                    if (leader) {
                        // æ˜¾ç¤ºä¸€ä½å°æ•°ï¼Œä½¿è¿›åº¦å·®è·æ›´æ˜æ˜¾
                        const progress = Math.min(100, parseFloat(maxPosition).toFixed(1));
                        raceProgress.textContent = `é¢†å…ˆè€…: ${leader} (${progress}%)`;
                    }
                    
                    // æ›´æ–°æ’å
                    updateRanking();
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰é¸­å­åˆ°è¾¾ç»ˆç‚¹ï¼ˆ100%ï¼‰
                    let winner = null;
                    nameArray.forEach(name => {
                        if (duckPositions[name] >= 100 && isRacing) {
                            winner = name;
                        }
                    });
                    
                    if (winner) {
                        finishRace(winner);
                    }
                    
                }, 50);
            }
            
            // ç»“æŸæ¯”èµ›
            function finishRace(winner) {
                clearInterval(raceInterval);
                isRacing = false;
                startBtn.disabled = false;
                
                result.textContent = `æ­å–œ ${winner} è·èƒœï¼`;
                resultSubtitle.textContent = "ç‚¹å‡»é‡ç½®æŒ‰é’®å¼€å§‹æ–°çš„æ¯”èµ›";
                result.classList.add('winner');
                raceProgress.textContent = `æ¯”èµ›ç»“æŸï¼è·èƒœè€…: ${winner}`;
                
                // æ›´æ–°æ’å
                updateRanking();
                
                // æ·»åŠ åˆ°å†å²è®°å½•
                const now = new Date();
                const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                historyArray.unshift(`${winner} - ${timeString}`);
                if (historyArray.length > 10) {
                    historyArray = historyArray.slice(0, 10);
                }
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                stats.races++;
                stats.lastWinner = winner;
                updateStats();
                
                updateHistoryList();
                createConfetti();
            }
            
            // é‡ç½®æ¯”èµ›
            function resetRace() {
                clearInterval(raceInterval);
                isRacing = false;
                startBtn.disabled = false;
                
                result.textContent = "ç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œè§‚çœ‹é¸­å­èµ›è·‘ï¼";
                resultSubtitle.textContent = "å‡†å¤‡å¥½å¼€å§‹ä¸€åœºæœ‰è¶£çš„æ¯”èµ›äº†å—ï¼Ÿ";
                result.classList.remove('winner');
                raceProgress.textContent = "æ¯”èµ›å‡†å¤‡ä¸­...";
                
                // é‡ç½®æ‰€æœ‰é¸­å­çš„ä½ç½®
                nameArray.forEach(name => {
                    duckPositions[name] = 0;
                    if (duckElements[name]) {
                        duckElements[name].style.left = '0px';
                    }
                });
                
                // ç§»é™¤é“å…·
                itemsContainer.innerHTML = '';
                items = [];
                
                // é‡ç½®æ’å
                updateRanking();
            }
            
            // æ·»åŠ å§“å
            function addName() {
                const name = nameInput.value.trim();
                if (name) {
                    if (nameArray.length >= 50) {
                        alert('å·²è¾¾åˆ°æœ€å¤§å­¦ç”Ÿæ•°ï¼ˆ50åï¼‰ï¼');
                        return;
                    }
                    
                    if (!nameArray.includes(name)) {
                        nameArray.push(name);
                        nameInput.value = '';
                        updateNameList();
                        createDucks();
                        updateRanking();
                    } else {
                        alert('è¯¥å­¦ç”Ÿå·²å­˜åœ¨ï¼');
                    }
                } else {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å§“åï¼');
                }
            }
            
            // å¯¼å…¥åå•
            function importNames() {
                const text = importTextarea.value.trim();
                if (text) {
                    let names = text.split('\n')
                        .map(name => name.trim())
                        .filter(name => name.length > 0);
                    
                    // å»é‡å¹¶é™åˆ¶æœ€å¤š50ä¸ª
                    names = [...new Set(names)].slice(0, 50);
                    
                    if (names.length > 0) {
                        // åˆå¹¶ç°æœ‰åå•å’Œæ–°åå•ï¼Œå»é‡å¹¶é™åˆ¶æ€»æ•°
                        const combined = [...new Set([...nameArray, ...names])];
                        if (combined.length > 50) {
                            alert(`åå•æ€»æ•°ä¸èƒ½è¶…è¿‡50ä¸ªï¼Œå°†åªä¿ç•™å‰50ä¸ªã€‚å½“å‰æœ‰${combined.length}ä¸ªã€‚`);
                            nameArray = combined.slice(0, 50);
                        } else {
                            nameArray = combined;
                        }
                        
                        updateNameList();
                        createDucks();
                        updateRanking();
                        importModal.style.display = 'none';
                        importTextarea.value = '';
                    } else {
                        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å§“åï¼');
                    }
                } else {
                    alert('è¯·è¾“å…¥è¦å¯¼å…¥çš„åå•ï¼');
                }
            }
            
            // æ›´æ–°åå•æ˜¾ç¤º
            function updateNameList() {
                nameList.innerHTML = '';
                
                if (nameArray.length === 0) {
                    nameList.innerHTML = '<li class="empty-message">åå•ä¸ºç©ºï¼Œè¯·æ·»åŠ å­¦ç”Ÿ</li>';
                    countElement.textContent = '0';
                    return;
                }
                
                nameArray.forEach((name, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${name}</span>
                        <button class="delete-btn" data-index="${index}">Ã—</button>
                    `;
                    nameList.appendChild(li);
                });
                
                countElement.textContent = nameArray.length;
                
                // æ·»åŠ åˆ é™¤äº‹ä»¶ç›‘å¬
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        nameArray.splice(index, 1);
                        updateNameList();
                        createDucks();
                        updateRanking();
                    });
                });
                
                updateStats();
            }
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            function updateHistoryList() {
                historyList.innerHTML = '';
                
                if (historyArray.length === 0) {
                    historyList.innerHTML = '<li class="empty-message">æš‚æ— å†å²è®°å½•</li>';
                    return;
                }
                
                historyArray.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${index + 1}. ${item}`;
                    historyList.appendChild(li);
                });
            }
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            function updateStats() {
                totalStudents.textContent = nameArray.length;
                totalRaces.textContent = stats.races;
                lastWinner.textContent = stats.lastWinner;
            }
            
            // åˆ›å»ºåº†ç¥å½©èŠ±
            function createConfetti() {
                for (let i = 0; i < 150; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = duckColors[Math.floor(Math.random() * duckColors.length)];
                    confetti.style.opacity = '1';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    document.body.appendChild(confetti);
                    
                    // åŠ¨ç”»
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: 2000 + Math.random() * 2000,
                        easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                    });
                    
                    animation.onfinish = () => confetti.remove();
                }
            }
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            createRiverDecoration();
            createLanes();
            updateNameList();
            updateSpeed();
            updateRanking();
        });
    </script>
</body>
</html>
